{
  "db_name": "PostgreSQL",
  "query": "\n            WITH peer_counts AS (\n                SELECT\n                    torrent_id,\n                    COUNT(CASE WHEN status = 'seeding' THEN 1 END) AS current_seeders,\n                    COUNT(CASE WHEN status = 'leeching' THEN 1 END) AS current_leechers\n                FROM\n                    peers\n                GROUP BY\n                    torrent_id\n            )\n            UPDATE torrents AS t\n            SET\n                seeders = COALESCE(pc.current_seeders, 0),\n                leechers = COALESCE(pc.current_leechers, 0)\n            FROM\n                torrents AS t_alias -- Use an alias for the table in the FROM clause to avoid ambiguity\n            LEFT JOIN\n                peer_counts AS pc ON t_alias.id = pc.torrent_id\n            WHERE\n                t.id = t_alias.id AND\n                t.deleted_at IS NULL;\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": []
    },
    "nullable": []
  },
  "hash": "be1671602d0e2d5c5f430c344e239d8ef022c48b0a6326f095b2c61cadbfef9c"
}
