{
  "db_name": "PostgreSQL",
  "query": "\n            WITH periods AS (\n                SELECT generate_series(\n                    date_trunc($3, $1::DATE::TIMESTAMP),\n                    date_trunc($3, $2::DATE::TIMESTAMP),\n                    ('1 ' || $3)::INTERVAL\n                ) AS period\n            ),\n            stats AS (\n                SELECT\n                    date_trunc($3, t.created_at)::TIMESTAMP AS period,\n                    COUNT(*)::BIGINT AS count,\n                    COALESCE(SUM(t.size), 0)::BIGINT AS total_size,\n                    CASE $4\n                        WHEN 'video_resolution' THEN t.video_resolution::TEXT\n                        WHEN 'video_codec' THEN t.video_codec::TEXT\n                        WHEN 'audio_codec' THEN t.audio_codec::TEXT\n                        WHEN 'audio_channels' THEN t.audio_channels::TEXT\n                        WHEN 'audio_bitrate_sampling' THEN t.audio_bitrate_sampling::TEXT\n                        WHEN 'container' THEN t.container\n                        WHEN 'source' THEN eg.source::TEXT\n                        WHEN 'content_type' THEN tg.content_type::TEXT\n                        WHEN 'category' THEN tg.category::TEXT\n                        WHEN 'platform' THEN tg.platform::TEXT\n                        WHEN 'original_language' THEN tg.original_language::TEXT\n                        WHEN 'country_from' THEN tg.country_from\n                        ELSE NULL\n                    END AS attribute_value\n                FROM torrents t\n                JOIN edition_groups eg ON t.edition_group_id = eg.id\n                JOIN title_groups tg ON eg.title_group_id = tg.id\n                WHERE t.deleted_at IS NULL\n                  AND t.created_at >= $1::DATE\n                  AND t.created_at < ($2::DATE + INTERVAL '1 day')\n                  AND CASE $4\n                        WHEN 'video_resolution' THEN t.video_resolution IS NOT NULL\n                        WHEN 'video_codec' THEN t.video_codec IS NOT NULL\n                        WHEN 'audio_codec' THEN t.audio_codec IS NOT NULL\n                        WHEN 'audio_channels' THEN t.audio_channels IS NOT NULL\n                        WHEN 'audio_bitrate_sampling' THEN t.audio_bitrate_sampling IS NOT NULL\n                        WHEN 'container' THEN t.container IS NOT NULL\n                        WHEN 'source' THEN eg.source IS NOT NULL\n                        WHEN 'content_type' THEN tg.content_type IS NOT NULL\n                        WHEN 'category' THEN tg.category IS NOT NULL\n                        WHEN 'platform' THEN tg.platform IS NOT NULL\n                        WHEN 'original_language' THEN tg.original_language IS NOT NULL\n                        WHEN 'country_from' THEN tg.country_from IS NOT NULL\n                        ELSE TRUE\n                      END\n                GROUP BY period, attribute_value\n            ),\n            attribute_values AS (\n                SELECT DISTINCT attribute_value FROM stats WHERE attribute_value IS NOT NULL\n            )\n            SELECT\n                p.period::TIMESTAMP AS \"period!\",\n                COALESCE(s.count, 0)::BIGINT AS \"count!\",\n                COALESCE(s.total_size, 0)::BIGINT AS \"total_size!\",\n                av.attribute_value\n            FROM periods p\n            LEFT JOIN attribute_values av ON TRUE\n            LEFT JOIN stats s ON p.period = s.period\n                AND s.attribute_value IS NOT DISTINCT FROM av.attribute_value\n            WHERE p.period >= COALESCE(\n                date_trunc(\n                    $3,\n                    (SELECT MIN(created_at) FROM torrents WHERE deleted_at IS NULL)\n                )::TIMESTAMP,\n                p.period\n            )\n            ORDER BY p.period, av.attribute_value\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "period!",
        "type_info": "Timestamp"
      },
      {
        "ordinal": 1,
        "name": "count!",
        "type_info": "Int8"
      },
      {
        "ordinal": 2,
        "name": "total_size!",
        "type_info": "Int8"
      },
      {
        "ordinal": 3,
        "name": "attribute_value",
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Left": [
        "Date",
        "Date",
        "Text",
        "Text"
      ]
    },
    "nullable": [
      null,
      null,
      null,
      null
    ]
  },
  "hash": "cbb68e41f50672855be28c7786a7728cdd04ae29466a7d92635b57cccf7dda85"
}
