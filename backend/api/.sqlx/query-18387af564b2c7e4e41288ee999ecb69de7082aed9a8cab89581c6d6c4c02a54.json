{
  "db_name": "PostgreSQL",
  "query": "\n        WITH unique_seeding_torrents AS (\n            SELECT DISTINCT user_id, torrent_id\n            FROM peers\n            WHERE seeder = true\n        ),\n        seeding_totals AS (\n            SELECT ust.user_id, SUM(t.size) as total_size\n            FROM unique_seeding_torrents ust\n            JOIN torrents t ON ust.torrent_id = t.id\n            GROUP BY ust.user_id\n        ),\n        users_to_update AS (\n            SELECT u.id, COALESCE(st.total_size, 0) as new_seeding_size\n            FROM users u\n            LEFT JOIN seeding_totals st ON st.user_id = u.id\n            WHERE st.user_id IS NOT NULL OR u.seeding_size > 0\n        )\n        UPDATE users u\n        SET seeding_size = utu.new_seeding_size\n        FROM users_to_update utu\n        WHERE u.id = utu.id\n          AND u.seeding_size != utu.new_seeding_size\n        ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": []
    },
    "nullable": []
  },
  "hash": "18387af564b2c7e4e41288ee999ecb69de7082aed9a8cab89581c6d6c4c02a54"
}
