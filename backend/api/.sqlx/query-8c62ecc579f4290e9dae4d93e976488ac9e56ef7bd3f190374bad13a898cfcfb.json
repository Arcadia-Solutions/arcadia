{
  "db_name": "PostgreSQL",
  "query": "\n            WITH collage_entries_data AS (\n                SELECT\n                    ce.collage_id,\n                    COALESCE(\n                        jsonb_agg(\n                            jsonb_build_object(\n                                'id', ce.id,\n                                'created_at', ce.created_at,\n                                'created_by_id', ce.created_by_id,\n                                'artist_id', ce.artist_id,\n                                'artist', CASE\n                                            WHEN a.id IS NOT NULL THEN\n                                                jsonb_build_object(\n                                                    'id', a.id,\n                                                    'name', a.name,\n                                                    'pictures', a.pictures\n                                                )\n                                            ELSE NULL\n                                        END,\n                                'entity_id', ce.entity_id,\n                                'entity', CASE\n                                            WHEN e.id IS NOT NULL THEN\n                                                jsonb_build_object(\n                                                    'id', e.id,\n                                                    'name', e.name,\n                                                    'pictures', e.pictures\n                                                )\n                                            ELSE NULL\n                                        END,\n                                'title_group_id', ce.title_group_id,\n                                'title_group', tgd.title_group_data,\n                                'master_group_id', ce.master_group_id,\n                                'master_group', CASE\n                                                    WHEN mg.id IS NOT NULL THEN\n                                                        jsonb_build_object(\n                                                            'id', mg.id,\n                                                            'name', mg.name\n                                                        )\n                                                    ELSE NULL\n                                                END,\n                                'collage_id', ce.collage_id,\n                                'note', ce.note\n                            )\n                        ), '[]'::jsonb\n                    ) AS entries\n                FROM collage_entry ce\n                LEFT JOIN artists a ON ce.artist_id = a.id\n                LEFT JOIN entities e ON ce.entity_id = e.id\n                LEFT JOIN master_groups mg ON ce.master_group_id = mg.id\n                LEFT JOIN get_title_groups_and_edition_group_and_torrents_lite() AS tgd ON tgd.title_group_id = ce.title_group_id\n                WHERE ce.collage_id = $1\n                GROUP BY ce.collage_id\n            )\n            SELECT\n                jsonb_build_object(\n                    'collage', to_jsonb(c),\n                    'entries', COALESCE(ced.entries, '[]'::jsonb)\n                ) AS collage_data\n            FROM collage c\n            LEFT JOIN collage_entries_data ced ON ced.collage_id = c.id\n            WHERE c.id = $1;\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "collage_data",
        "type_info": "Jsonb"
      }
    ],
    "parameters": {
      "Left": [
        "Int8"
      ]
    },
    "nullable": [
      null
    ]
  },
  "hash": "8c62ecc579f4290e9dae4d93e976488ac9e56ef7bd3f190374bad13a898cfcfb"
}
