{
  "db_name": "PostgreSQL",
  "query": "\n                INSERT INTO torrent_activities (\n                    torrent_id,\n                    user_id,\n                    completed_at,\n                    first_seen_seeding_at,\n                    last_seen_seeding_at,\n                    total_seed_time,\n                    uploaded,\n                    real_uploaded,\n                    downloaded,\n                    real_downloaded\n                )\n                SELECT\n                    agg.torrent_id,\n                    agg.user_id,\n                    agg.completed_at,\n                    agg.first_seen_seeding_at,\n                    agg.last_seen_seeding_at,\n                    0,\n                    agg.uploaded_delta,\n                    agg.real_uploaded_delta,\n                    agg.downloaded_delta,\n                    agg.real_downloaded_delta\n                FROM (\n                    SELECT\n                        t.torrent_id,\n                        t.user_id,\n                        MIN(t.completed_at) AS completed_at,\n                        MIN(CASE WHEN t.seeder THEN t.updated_at END) AS first_seen_seeding_at,\n                        MAX(CASE WHEN t.seeder THEN t.updated_at END) AS last_seen_seeding_at,\n                        SUM(t.uploaded_delta) AS uploaded_delta,\n                        SUM(t.real_uploaded_delta) AS real_uploaded_delta,\n                        SUM(t.downloaded_delta) AS downloaded_delta,\n                        SUM(t.real_downloaded_delta) AS real_downloaded_delta\n                    FROM unnest(\n                        $1::int[],\n                        $2::int[],\n                        $3::timestamptz[],\n                        $4::bigint[],\n                        $5::bigint[],\n                        $6::bigint[],\n                        $7::bigint[],\n                        $8::boolean[],\n                        $9::timestamptz[]\n                    ) AS t(\n                        torrent_id,\n                        user_id,\n                        completed_at,\n                        uploaded_delta,\n                        downloaded_delta,\n                        real_uploaded_delta,\n                        real_downloaded_delta,\n                        seeder,\n                        updated_at\n                    )\n                    GROUP BY t.torrent_id, t.user_id\n                ) AS agg\n                ON CONFLICT (torrent_id, user_id) DO UPDATE SET\n                    completed_at = COALESCE(torrent_activities.completed_at, EXCLUDED.completed_at),\n                    first_seen_seeding_at = COALESCE(torrent_activities.first_seen_seeding_at, EXCLUDED.first_seen_seeding_at),\n                    last_seen_seeding_at = GREATEST(torrent_activities.last_seen_seeding_at, EXCLUDED.last_seen_seeding_at),\n                    total_seed_time = torrent_activities.total_seed_time,\n                    uploaded = torrent_activities.uploaded + COALESCE(EXCLUDED.uploaded, 0),\n                    real_uploaded = torrent_activities.real_uploaded + COALESCE(EXCLUDED.real_uploaded, 0),\n                    downloaded = torrent_activities.downloaded + COALESCE(EXCLUDED.downloaded, 0),\n                    real_downloaded = torrent_activities.real_downloaded + COALESCE(EXCLUDED.real_downloaded, 0)\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Int4Array",
        "Int4Array",
        "TimestamptzArray",
        "Int8Array",
        "Int8Array",
        "Int8Array",
        "Int8Array",
        "BoolArray",
        "TimestamptzArray"
      ]
    },
    "nullable": []
  },
  "hash": "43ca35fea526b25dffb69e86700c0d3a1bdebdb973df5059ff7eb3e9a933eb33"
}
